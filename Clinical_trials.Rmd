---
title: "Clinical Trials"

output: 
  html_document:
    toc: true
    toc_float: true
    theme: cosmo
    code_folding: hide
---
```{r, include = FALSE, message = FALSE, warning = FALSE}
library(readxl)
library(tidyverse)
library(plotly)
library(ggplot2)
library(knitr)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	message = FALSE,
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)
```

# Clinical Trials Pipeline
In our quest to deepen the understanding of Alzheimer's disease and its treatment landscape, we have developed an innovative Shiny application designed to visualize the clinical trials of Alzheimer's drugs across the United States. This interactive tool is a significant stride in making complex trial data accessible, which label all trials on the map and have regional statistics based on zoom size. The following screenshot offers a glimpse into the app's capabilities, and the full dashboard can be accessed [here].

<img src="project_image/shiny_CT1.png" style="width:85%">

# Lecanemab and Donanemab

## Participants' Baseline Demographics for both drugs

```{r, message = FALSE, warning = FALSE}
sex_df=
  readxl::read_excel("data/newdrugdemographic.xlsx",sheet="Sex", range = "A1:C5") |> 
  janitor::clean_names()
sex_df |> 
  plot_ly(x=~drug, y=~sex_prop, type = "bar", color = ~sex) |> 
  layout(barmode = "stack",
         title = "Distribution of Participants' Baseline Sex by drugs",
         xaxis = list(title = "Drug"),
         yaxis = list(title = "Percentage (%)"))
```
* From the plot, we can see that there are more female participants in Donanemab's clinical trial than that in Lecanemab's clinical trial.

```{r, message = FALSE, warning = FALSE}
race_df=
  readxl::read_excel("data/newdrugdemographic.xlsx",sheet="Race", range = "A1:C9") |> 
  janitor::clean_names()
race_df |> 
  plot_ly(x=~drug, y=~race_prop, type = "bar", color = ~race) |> 
  layout(barmode = "stack",
         title = "Distribution of Participants' Baseline Race by drugs",
         xaxis = list(title = "Drug"),
         yaxis = list(title = "Percentage (%)"))
```
* From the plot, we can see there is more diversity in  Lecanemab's clinical trial. Races other than white occupies a larger proportion of participants in Lecanemab's clinical trial than that in Donanemab's clinical trial than that in Lecanemab's clinical trial, especially Asians.

## Donanemab
The outcomes listed include iADRS (Integrated Alzheimer's Disease Rating Scale), MMSE (Mini-Mental State Examination), and other clinical assessments. The table provides valuable insights into the efficacy of donanemab compared to placebo in slowing the progression of Alzheimer's disease over the 76-week period in the different populations studied.

In the TRAILBLAZER-ALZ 2 clinical trial, the participants were divided into two populations based on their tau biomarker levels: the low/medium tau population and the high tau population. Tau is a protein that accumulates in the brain of people with Alzheimer's disease and is associated with neurodegeneration.

The low/medium tau population included participants with mild cognitive impairment or early Alzheimer's disease who had low or intermediate levels of tau biomarkers in their cerebrospinal fluid (CSF). The high tau population included participants with early Alzheimer's disease who had high levels of tau biomarkers in their CSF.

The combined population included all participants in the trial, regardless of their tau biomarker levels. The purpose of dividing the participants into these populations was to assess the efficacy of donanemab in different subgroups of patients with Alzheimer's disease.

### iADRS
The Integrated Alzheimer's Disease Rating Scale (iADRS) is a comprehensive assessment tool used to measure the progression of Alzheimer's disease. It combines the 13-item cognitive subscale of the Alzheimer's Disease Assessment Scale (ADAS-Cog13) with the Alzheimer's Disease Cooperative Study—Instrumental Activities of Daily Living (ADCS-iADL). By integrating these measures, the iADRS provides a holistic evaluation of both cognitive function and daily living activities in individuals with Alzheimer's disease.

```{r}
iADRS <- read_excel("data/Donanemab_.xlsx", sheet = "1")

ggplot(iADRS, aes(x = as.factor(time), y = mean, fill = group, color = group)) +
  geom_point(position = position_dodge(0.9), size = 3, alpha = 0.7) +
  geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper), position = position_dodge(0.9), width = 0.25) +
  facet_wrap(~outcome, scales = "free_y") +
  labs(title = "Mean with 95% CI over Time",
       x = "Time",
       y = "Mean") +
  theme_minimal()
```

The results show that treatment with donanemab resulted in a statistically significant slowing of clinical progression compared to placebo in both the low/medium tau and combined populations. 

### CDR-SB
The Clinical Dementia Rating Scale Sum of Boxes (CDR-SB) is a widely used assessment tool for evaluating the severity of dementia. It is a composite score derived from the Clinical Dementia Rating (CDR) scale, which is used to assess the cognitive and functional abilities of individuals with dementia.

The CDR-SB incorporates ratings across six domains: memory, orientation, judgment and problem solving, community affairs, home and hobbies, and personal care. Each domain is rated on a scale from 0 (no impairment) to 3 (severe impairment), and the total CDR-SB score ranges from 0 to 18, with higher scores indicating greater clinical impairment.
```{r}
CDR_SB <- read_excel("data/Donanemab_.xlsx", sheet = "2")

ggplot(CDR_SB, aes(x = as.factor(time), y = mean, fill = group, color = group)) +
  geom_point(position = position_dodge(0.9), size = 3, alpha = 0.7) +
  geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper), position = position_dodge(0.9), width = 0.25) +
  facet_wrap(~outcome, scales = "free_y") +
  labs(title = "Mean with 95% CI over Time",
       x = "Time",
       y = "Mean") +
  theme_minimal()
```

The trial results demonstrated that treatment with donanemab resulted in a statistically significant slowing of clinical progression as measured by the CDR-SB, indicating its potential efficacy in addressing the symptoms and functional decline associated with early symptomatic Alzheimer's disease.

### ADCS-iADL
The Alzheimer's Disease Cooperative Study—Instrumental Activities of Daily Living (ADCS-iADL) is a measurement tool used to assess the functional abilities of individuals with Alzheimer's disease. It is designed to evaluate a person's capacity to perform various instrumental activities of daily living, such as managing finances, using the telephone, shopping, preparing meals, doing housework, and managing medications.

The ADCS-iADL scale provides a structured assessment of a person's functional independence and is particularly relevant for evaluating the impact of Alzheimer's disease on daily activities beyond basic self-care tasks. The scale typically ranges from 0 to 59, with lower scores indicating greater impairment in instrumental activities of daily living.
```{r}
ADCS_iADL <- read_excel("data/Donanemab_.xlsx", sheet = "3")

ggplot(ADCS_iADL, aes(x = as.factor(time), y = mean, fill = group, color = group)) +
  geom_point(position = position_dodge(0.9), size = 3, alpha = 0.7) +
  geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper), position = position_dodge(0.9), width = 0.25) +
  facet_wrap(~outcome, scales = "free_y") +
  labs(title = "Mean with 95% CI over Time",
       x = "Time",
       y = "Mean") +
  theme_minimal()
```

In the trial results, changes in ADCS-iADL reflected the impact of donanemab treatment on patients' functioning of daily living. By comparing changes in ADCS-iADL scores between the donanemab group and the placebo group, it was possible to assess the extent to which donanemab affected patients' functioning of daily living.

### ADCS-CGIC
The Alzheimer's Disease Cooperative Study—Clinical Global Impression of Change (ADCS-CGIC) is a measurement tool used to assess the overall clinical status and change over time in individuals with Alzheimer's disease. It is designed to provide a global assessment of a patient's condition, taking into account cognitive, functional, and behavioral aspects.

```{r}
ADCS_Cog13 <- read_excel("data/Donanemab_.xlsx", sheet = "4")

ggplot(ADCS_Cog13, aes(x = as.factor(time), y = mean, fill = group, color = group)) +
  geom_point(position = position_dodge(0.9), size = 3, alpha = 0.7) +
  geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper), position = position_dodge(0.9), width = 0.25) +
  facet_wrap(~outcome, scales = "free_y") +
  labs(title = "Mean with 95% CI over Time",
       x = "Time",
       y = "Mean") +
  theme_minimal()
```

A greater reduction in the least squares mean change from baseline to 76 weeks in the donanemab group compared to the placebo group would indicate a potential positive effect of donanemab on cognitive function.

### MMSE
The Mini-Mental State Examination (MMSE) is a widely used screening tool for cognitive impairment and is often employed in clinical and research settings to assess cognitive function, particularly in the context of dementia. The MMSE evaluates various cognitive domains, including orientation, memory, attention, language, and visuospatial abilities.

```{r}
MMSE <- read_excel("data/Donanemab_.xlsx", sheet = "5")

ggplot(MMSE, aes(x = as.factor(time), y = mean, fill = group, color = group)) +
  geom_point(position = position_dodge(0.9), size = 3, alpha = 0.7) +
  geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper), position = position_dodge(0.9), width = 0.25) +
  facet_wrap(~outcome, scales = "free_y") +
  labs(title = "Mean with 95% CI over Time",
       x = "Time",
       y = "Mean") +
  theme_minimal()
```

The MMSE scores provide information about the cognitive function of the participants in the study.  The mean scores and standard deviations can be used to compare the cognitive performance of the donanemab group and the placebo group.  A higher mean score in the donanemab group compared to the placebo group would suggest a potential positive effect of donanemab on cognitive function.

## Hazard Plots
The Phase III trials of Lecanemab and Donanemab both use cumulative hazard ratio to indicate the risk of progression assessed using CDR-SB score. The hazard plot for Donanemab is as following
```{r, message = FALSE, warning = FALSE}
Don_KM = 
  read_excel("./Data/Donanemab.xlsx", sheet = "K-M", range = "A1:D16") |>
  janitor::clean_names()

plot_ly(Don_KM |>
                 filter(test == "CDR-SB") |>
                 pivot_longer(
                   donanemab:placebo,
                   names_to = "drug",
                   values_to = "ratio"
                 ), x = ~time, y = ~ratio, color = ~drug, line = list(shape = "hv"), colors = "viridis") |>
  layout(title = "Plot 1 Title",
             xaxis = list(title = "X-axis Label for Plot 1"),
             yaxis = list(title = "Y-axis Label for Plot 1"))
```

## Adverse Events
As we progress in our comprehensive exploration of Alzheimer's disease and its treatment options, we now turn our focus to a critical aspect of drug evaluation: the analysis of adverse events associated with the two promising drugs, Lecanemab and Donanemab. This analysis is pivotal in understanding the safety profile and potential risks of these newly FDA-approved treatments, which stand at the forefront of Alzheimer's research.

```{r}
lec_safety = read_excel("./Data/Lecanemab.xlsx", sheet = "safety", range = "A1:C5") |>
  janitor::clean_names()

don_safety = read_excel("./Data/Donanemab.xlsx", sheet = "safety", range = "A1:C5") |>
  janitor::clean_names()

merge_safety = left_join(lec_safety, don_safety, by = "events")
```

```{r}
plot_ly(merge_safety |>
  mutate(events = fct_reorder(events, -lecanemab)) |>
  pivot_longer(
    lecanemab:donanemab_placebo,
    names_to = "drug",
    values_to = "cases"
  ), 
  x = ~events, y = ~cases, color = ~drug, type = 'bar', colors = "viridis")
```
Deaths occurred in 0.7% (6 cases) of the participants in the lecanemab group and 0.8% (7 cases) of those in the placebo group. No deaths were considered by the investigators to be related to lecanemab or occurred with ARIA. Serious adverse events occurred in 14.0% (126 cases) of the participants in the lecanemab group and 11.3% (101 cases) of those in the placebo group. The incidence of death was 1.9% (16 cases) in the donanemab group and 1.1% (10 cases) in the placebo group, while the incidence of serious adverse events was 17.4% (148 cases) in the donanemab group and 15.8% (138 cases) in the placebo group. 

```{r}
safety_test = function(a, b, c, d, n1, n2){
  RD = round(a/n1 - b/n2, 4)
  RR = round((a/n1)/(b/n2), 4)
  OR = round((a*d)/(b*c), 4)
  Chis = round(prop.test(x = c(a, b), n = c(c, d), alternative = "two.sided", correct = FALSE)$statistic, 4)
  p_value = round(prop.test(x = c(a, b), n = c(n1, n2), alternative = "two.sided", correct = FALSE)$p.value, 6)
  return (tibble(Risk_Diff = RD, Risk_Ratio = RR, Odds_Ratio = OR, Xsquared = Chis, P.value = p_value))
  }
```

```{r}
lec_safety_test = safety_test(126, 101, 772, 796, 898, 897)
don_safety_test = safety_test(148, 138, 705, 736, 853, 874)
comp_safety_test = safety_test(126, 148, 772, 705, 898, 853)
safety_merge = bind_rows(lec_safety_test, don_safety_test, comp_safety_test) |>
  mutate(Test = c("Lec vs Placebo", "Don vs Placebo", "Lec vs Don")) |>
  select(Test, everything())

kable(safety_merge)
```

In our statistical analysis of serious adverse events associated with Lecanemab, Donanemab, and their placebos, we have identified key findings. With a significance level set at 0.1, our results indicate a significant difference in serious adverse events between Lecanemab and its placebo, suggesting a higher risk associated with Lecanemab. In contrast, Donanemab did not show a significant difference in serious adverse events compared to its placebo, implying a potentially safer profile. Additionally, a significant difference was observed between Lecanemab and Donanemab, highlighting distinct safety profiles for these drugs.

Then, we further investigate the differences of specific adverse events for two drugs.

```{r}
lec_ae = read_excel("./Data/Lecanemab.xlsx", sheet = "AE", range = "A1:C10") |>
  janitor::clean_names()

don_ae = read_excel("./Data/Donanemab.xlsx", sheet = "AE", range = "A1:C10") |>
  janitor::clean_names()

merge_ae = left_join(lec_ae, don_ae, by = "ae")
```

```{r}
plot_ly(merge_ae |>
  mutate(ae = fct_reorder(ae, donanemab)) |>
  pivot_longer(
    lecanemab:donanemab_placebo,
    names_to = "drug",
    values_to = "cases"
  ), 
  x = ~ae, y = ~cases, color = ~drug, type = 'bar', colors = "viridis")
```

[Interpretation]

Lecanemab vs Placebo
```{r}
# test = lec_ae |>
#   mutate(p = lecanemab_placebo/sum(lecanemab_placebo))
# chisq.test(test$lecanemab, p = test$p, correct = FALSE) \
lec_ae_result = lec_ae |>
  mutate(testresult = map2(lecanemab, lecanemab_placebo, \(a, b) safety_test(a, b, 898-a, 897-b, 898, 897))) |>
  unnest(testresult) |>
  select(-lecanemab, -lecanemab_placebo)

kable(lec_ae_result)
```

Donanemab vs Placebo
```{r}
# test = don_ae |>
#   mutate(p = donanemab_placebo/sum(donanemab_placebo))
# chisq.test(test$donanemab, p = test$p, correct = FALSE)

don_ae_result = don_ae |>
  mutate(testresult = map2(donanemab, donanemab_placebo, \(a, b) safety_test(a, b, 853-a, 874-b, 853, 874))) |>
  unnest(testresult) |>
  select(-donanemab, -donanemab_placebo)

kable(don_ae_result)
```

Lecanemab vs Donanemab
```{r}
# test = don_ae |>
#   mutate(p = donanemab_placebo/sum(donanemab_placebo))
# chisq.test(lec_ae$lecanemab, p = test$p, correct = FALSE) 
com_ae =  don_ae |>
  mutate(lecanemab = lec_ae$lecanemab) |>
  select(-donanemab_placebo)

com_ae_test = com_ae |>
  mutate(testresult = map2(lecanemab, donanemab, \(a, b) safety_test(a, b, 898-a, 853-b, 898, 853))) |>
  unnest(testresult) |>
  select(-donanemab, -lecanemab)

kable(com_ae_test)
```
